# 雏鸟计划-产销报表系统开发说明

## 1. 项目概述

本项目（代号：雏鸟计划）是一个为集团公司及其下属单位开发的产销数据在线填报与汇总系统。旨在替代原有的线下Excel汇报模式，实现数据的实时收集、自动计算、统一汇总和在线校验，提高数据上报的效率和准确性。

当前版本为**前端原型V1.0**，已实现核心的数据填报、动态计算和导出功能，为后续开发奠定了坚实的基础。

## 2. 技术栈

本项目为纯前端应用，采用了现代化的Vue.js生态系统：

- **核心框架:** Vue 3 (Composition API)
- **构建工具:** Vite
- **路由:** Vue Router
- **代码规范:** ESLint, Prettier
- **UI组件:** 基于原生HTML/CSS/JS手写，未引入第三方组件库

## 3. 项目结构

```
nestling/
├───public/               # 静态资源
├───src/
│   ├───assets/           # 样式、图片等资源
│   ├───layouts/
│   │   └───MainLayout.vue  # 主应用布局（包含侧边栏和主内容区）
│   ├───router/
│   │   └───index.js      # 路由配置
│   ├───services/
│   │   ├───menuData.js     # **核心文件**：定义侧边栏菜单结构和各单位的报表权限
│   │   └───reportTemplate.js # **核心文件**：定义所有报表的结构、计算公式和元数据
│   ├───views/
│   │   ├───DashboardView.vue # 仪表盘/主页
│   │   ├───DataEntryView.vue # **核心页面**：数据填报页，动态渲染报表
│   │   └───LoginView.vue     # 登录页
│   ├───App.vue             # 根组件
│   └───main.js             # 应用入口
├───DEVELOPMENT_GUIDE.md  # 本开发说明
└───package.json          # 项目依赖与脚本
```

### 关键文件说明

- **`src/services/menuData.js`**:
  - 定义了左侧导航栏的层级结构。
  - 严格按照业务需求，为每个单位（如“集团公司”、“主城区”、“北海热电厂”等）分配了其负责填报或查看的报表列表。
  - 是实现多单位、多报表权限隔离的基础。

- **`src/services/reportTemplate.js`**:
  - **项目的“数据大脑”**。该文件源自《1各单位产销计划模板.csv》。
  - 它以JavaScript对象的形式，定义了系统中**所有15个报表**的完整结构。
  - 每个报表的每一行（指标）都包含以下信息：
    - `id`: 指标唯一序号。
    - `name`: 指标名称。
    - `unit`: 计量单位。
    - `calc`: **计算公式**。使用 `VAL(id)` 的形式来引用其他指标的值进行计算。
    - `scope`: **适用范围**。一个数组，包含了可以使用该指标的报表ID。这是实现“不同报表显示不同指标”的关键。
    - `isTotal`: 标记该行是否为小计或总计，用于样式区分。
    - `isGroupPreFilled`: 标记该行的“同期值”是否由集团预填。

- **`src/views/DataEntryView.vue`**:
  - 数据填报功能的核心实现。
  - 通过监听路由参数 `tableId` 的变化，从 `reportTemplate.js` 中过滤出对应报表所需的指标行，并动态渲染成可编辑的表格。
  - **实现了核心的自动计算逻辑**：通过 Vue 3 的 `watch` 侦听器，监控所有可输入单元格的数据变化。一旦某个单元格的值发生改变，会立即触发所有依赖于它的计算公式（`calc`）的重新计算，并更新界面。

## 4. 核心功能与实现逻辑

### 4.1. 动态报表生成

- 用户在左侧菜单点击某个报表名称时，路由会跳转至 `/data-entry/:tableId`。
- `DataEntryView.vue` 获取 `tableId`，并根据 `reportTemplate.js` 中每个指标的 `scope` 属性，动态构建当前报表的结构。

### 4.2. 自动计算

- `DataEntryView.vue` 内部维护一个响应式对象 `tableData`，用于存储表格中所有单元格的值。
- 页面初始化时，会遍历当前报表的所有指标。对于带有 `calc` 公式的指标，会创建一个 `watch` 来监控其依赖项（即 `VAL(id)` 中引用的所有 `id` 对应的单元格）。
- 当用户修改一个单元格的数据时，相关的 `watch` 会被触发，执行 `calc` 字符串中定义的公式，并将结果更新到 `tableData` 中，从而实现页面数据的实时自动更新。

### 4.3. UI/UX 优化

- **完全可伸缩的侧边栏**：侧边栏可以完全收起，不保留任何图标，以提供最大的内容可视区域。
- **固定操作按钮**：在数据填报页面，下方的“保存”、“提交”、“导出”等按钮被固定在屏幕底部，即使用户滚动长表格，这些按钮也始终可见。
- **可滚动的表格区域**：为了防止超长表格导致页面无限滚动，表格本身被限制在父容器内，并拥有独立的滚动条。

### 4.4. 数据导出

- “导出”按钮会触发一个功能，该功能将当前表格的 `tableData` 转换为CSV格式并下载到本地。

## 5. 开发与部署

1.  **安装依赖**
    ```bash
    npm install
    ```

2.  **启动本地开发服务器**
    ```bash
    npm run dev
    ```
    应用将在本地的一个端口上运行（通常是 `http://localhost:5173`）。

3.  **构建生产版本**
    ```bash
    npm run build
    ```
    构建产物将生成在 `dist` 目录下。

## 6. 已知问题与未来工作

当前版本是一个功能完整的**前端原型**，为验证业务流程和核心逻辑而构建。后续开发需要重点关注以下方面：

1.  **后端服务集成 (最高优先级)**
    - **用户认证**: 实现真实的登录接口，替换当前的模拟登录。
    - **数据持久化**: 开发API，用于“保存”和“提交”报表数据到数据库。
    - **数据加载**: 开发API，用于在进入报表页面时，从数据库加载已保存的数据。
    - **数据汇总**: 在后端实现集团层面的数据汇总逻辑。`reportTemplate.js` 中的 `summaryRule` 字段已预留，可作为后端汇总的依据。

2.  **数据校验**
    - 根据《业务需求说明书》中的规则，在前端或后端实现数据校验逻辑。例如，某些字段必须为数字、不能为空，或满足特定的业务约束。校验失败时应给予用户明确提示。

3.  **用户与权限管理**
    - 需要一个后台系统来管理不同单位的用户及其权限，与本系统前端的 `menuData.js` 对应。

4.  **代码优化与重构**
    - **状态管理**: 随着应用复杂度的增加，可以考虑引入 Pinia 等状态管理库，以更优雅地管理 `tableData` 和用户信息。
    - **组件拆分**: `DataEntryView.vue` 目前比较庞大，可以将表格、计算逻辑等拆分为更小的、可复用的组件。

---
希望这份文档能帮助您快速上手。祝开发顺利！
